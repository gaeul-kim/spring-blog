<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" layout:decorator="layouts/sidebar"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <title>Blog Home</title>
</head>
<body>


<!-- Post Content Column -->
<div layout:fragment="content">
    <!-- Title -->
    <h1 class="mt-4">Sign up</h1>
    <hr>

    <div class="row">
        <form id="join-form" class="col-lg-12 mb-4" action="/join" method="post">
            <div class="form-group">
                <label for="name" class="d-none">아이디</label>
                <input id="name" class="form-control" name="name" type="text" placeholder="아이디"
                       data-validate-type="name" data-validate-required="true">
            </div>
            <div class="form-group">
                <label for="password" class="d-none">비밀번호</label>
                <input id="password" class="form-control" name="password" type="password" placeholder="비밀번호"
                       data-validate-type="password" data-validate-required="true">
            </div>
            <div class="form-group">
                <label for="password-check" class="d-none">비밀번호 확인</label>
                <input id="password-check" class="form-control" type="password" placeholder="비밀번호 확인"
                       data-validate-type="password-check" data-validate-required="true">
            </div>
            <div class="form-group">
                <button id="join-submit" class="btn btn-secondary form-control" type="submit">Sign up</button>
            </div>
        </form>
    </div>

    <script>
        $.fn.validate = function () {
            var _isValidate = true;

            $(this).find('input[data-validate-required="true"]').each(function () {
                var _this = $(this);
                var _type = _this.data('validate-type');
                var _val = _this.val();
                var _regExp = new RegExp();
                var _message = '';

                _this.closest('div').find('span.error').remove();

                switch (_type) {
                    case 'name':
                        //_regExp = /^[A-Za-z]{1}[A-Za-z0-9_]{2,14}$/;
                        _regExp = /^[A-Za-z0-9_]{3,15}$/;
                        _test = _regExp.test(_val);
                        _message = (!_test) ? '3~15자의 영문, 숫자, 특수기호(_)만 가능합니다.' : '';
                        break;
                    case 'password':
                        _regExp = /^(?=.*[a-zA-Z])((?=.*\d)|(?=.*\W)).{5,15}$/;
                        _test = _regExp.test(_val);
                        _message = (!_test) ? '5~15자의 영문, 숫자나 특수문자가 필요합니다.' : '';
                        break;
                    case 'password-check':
                        var _password = _this.closest('form').find('#password').val();
                        _message = (_val != _password) ? '비밀번호가 일치하지 않습니다.' : '';
                        break;
                }

                if (!_test) {
                    _this.closest('div').append('<span class="error" style="color:red; font-size:0.7em;">' + _message + '</span>');
                    _isValidate = false;
                }

            });

            return _isValidate;
        }

        $('#join-submit').click(function (e) {
            e.preventDefault();
            var _form = $('#join-form');
            var _result = _form.validate();
            if (_result) {
                _form.submit();
            }
        })
    </script>
</div>

</body>
</html>
